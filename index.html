<!doctype html>
<html lang="en" data-framework="javascript">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="index.css">
        <title>Sample</title>
    </head>
    <body>
        <div id="rxjs-example">
            <h2>
                <img src="./assets/rxjs.png" />
                RxJS Code example for QuantumSDK
            </h2>
            <section>
                <div class="example-title">
                    RxJS Hello World
                </div>
                <div class="example-content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
const obs = Rx.Observable.create(observer => {
    observer.next('Hello World');
});

obs.subscribe(result => {
    console.log(result);
}); 
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <h3>Observable Hello World</h3>
                        <div class="w3-panel w3-card" id="helloworld-box"></div>
                    </div>
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from input event
                </div>
                <div class="example-content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
const obs = Rx.Observable.create(observer => {
    observer.next('Hello World');
});

obs.subscribe(result => {
    console.log(result);
}); 
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <h3>Observable of input event</h3>
                        <input class="w3-input w3-border" type="text" placeholder="Text" name="text" id="input-example">
                        <h4>Result</h4>
                        <ul>
                            <li><span><b>Input result:</b> 0</span></li>
                            <li><span><b>Number of letters:</b> 0</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from data structure event
                </div>
                <div class="example-content">
                    <div class="code" style="width:50%">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
let btnRegister = document.getElementById('register');
let btnShow = document.getElementById('show');
let namesList = [];

let input = Rx.Observable.fromEvent(btnRegister, 'click');
input.subscribe(response => {
    let firstName = document.getElementById("fn").value;
    let lastName = document.getElementById("ln").value;
    let fullName = {
        firstName: firstName,
        lastName: lastName
    };
    namesList.push(fullName);
    document.getElementById("fn").value = '';
    document.getElementById("ln").value = '';
    showList();
});

function showList(){
    var list = Rx.Observable
    .interval(500)
    .take(namesList.length)
    .map(i => namesList[i]);

    var box = document.getElementById('collection-box');
    box = removeAllChildrenFromNode(box);

    list.subscribe(name => {
        console.log(name);
        appendNamesToDOM(name, box);
    });
}

function toTemplate(name){
    var a = document.createElement("a");
    a.textContent = name.firstName + ' ' + name.lastName;
    a.style.color = "#de0790";
    var div = document.createElement("div");
    div.appendChild(a);
    return div;
}

function appendNamesToDOM(name, box){
    var t = toTemplate(name);
    box.appendChild(t);
}

function removeAllChildrenFromNode(node){
    var shell = node.cloneNode(false);
    if (node.parentNode) {
        node.parentNode.replaceChild(shell, node);
    }
    return shell;
}
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <div class="w3-card-4" style="width:50%; margin: 0 auto;">
                            <p>      
                            <label class="w3-text-brown"><b>First Name</b></label>
                            <input class="w3-input w3-border w3-sand" style="width:90%; margin: 0 auto;" name="first" type="text" id='fn'></p>
                            <p>      
                            <label class="w3-text-brown"><b>Last Name</b></label>
                            <input class="w3-input w3-border w3-sand" style="width:90%; margin: 0 auto;" name="last" type="text" id='ln'></p>
                            <p>
                            <div class="w3-center">
                                <button class="w3-btn w3-brown w3-round-large" id="register">Register</button></p>
                            </div>
                            </p>
                        </div>
                        <div class="w3-container w3-block w3-purple w3-round-large w3-hover-pink w3-center" style="width:50%; margin: 0 auto;" id="show"><p>Registerd Names</p></div>
                        <div class="w3-container w3-card w3-round-large" style="width:50%; margin: 0 auto;" id="collection-box"></div>
                    </div>
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from mouse event
                </div>
                <div class="example-content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
var mouseMove = Rx.Observable.fromEvent(document, "mousemove");
var text = "RxJs experiment";
var container = document.getElementById('mouseEvent-container');

for(var i=0; i < text.length; i++){
    (function(i){
        var s = document.createElement("span");
        s.innerHTML = text.charAt(i);
        s.style.position = "absolute";
        s.style.color = "#191970";
        container.appendChild(s);

        mouseMove.delay(i*100).subscribe(function(mouseEvent){
            s.style.top = mouseEvent.clientY + "px";
            s.style.left = mouseEvent.clientX + i * 10 + 15 + "px";
        });
    })(i);
}
                            </code>
                        </pre>                 
                    </div>
                    <div id="mouseEvent-container"></div>
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from "callback hell"
                </div>
                <div class="example-content">
                    Hi!  
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from basic Promise
                </div>
                <div class="example-content">
                    Hi!  
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from API request
                </div>
                <div class="example-content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
let btnViewGenres = document.querySelector('.view-genres');
let requests$ = Rx.Observable
        .fromEvent(btnViewGenres, 'click')
        .map( _ => 'https://api.themoviedb.org/3/genre/movie/list?api_key=76f6b14f3a0fd2ed9f79af9b6db27612&language=en-US');
let responses$ = requests$
        .flatMap(url => Rx.Observable.fromPromise(fetch(url)))
        .flatMap(r => Rx.Observable.fromPromise(r.json()));
let genres$ = responses$.map(getGenres);

genres$.subscribe(response => {
    response.forEach((genre) => {
        appendGenresToDOM(genre);
    });
});

function getGenres(res){
    return res.genres;
}

function toTemplate(genre){
    var a = document.createElement("a");
    a.textContent = genre.name;
    var div = document.createElement("div");
    div.appendChild(a);
    return div;
}

function appendGenresToDOM(genre){
    var t = toTemplate(genre);
    var g = document.getElementById('genres-box');
    g.appendChild(t);
}
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <button onClick="this.disabled=true;" class="w3-button w3-block w3-purple w3-round-large w3-hover-pink" style="width:100%" id="view-genres">View list of official genres for movies</button>
                        <div class="w3-panel w3-card" id="genres-box"></div>
                    </div>
                </div>
            </section>

            <section>
                <div class="example-title">
                    RxJS from ... any implementation
                </div>
                <div class="example-content">
                    This Accordion was implemented using RxJS!! :D 
                </div>
            </section>
        </div>

        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>        
        <script src="dist/bundle.js"></script>
    </body>
</html>