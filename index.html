<!doctype html>
<html lang="en" data-framework="javascript">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="index.css">
        <title>RXJS 101</title>
    </head>
    <body>
        <div class="page">
            <h2 class="page__title">
                <img class="page__image" src="./assets/rxjs.png" />
                RxJS Code Examples
            </h2>
            <section id="helloworld"></section>
            <section id="input-event"></section>
            <section id="array"></section>
            <section id="mouseevent"></section>
            <section id="callback"></section>

            <section class="example">
                <div class="example__title">
                    RxJS from basic Promise
                </div>
                <div class="example__content">
                    <div class="code">
                        <pre class="prettyprint lang-js">
                            <code>
const promise = new Promise((resolve, reject) => {
    const random = parseInt(Math.random() * 10);
    if (random === 0) {
        reject(random);
    }
    resolve(random);
});

const observable = Rx.Observable.fromPromise(promise);
const resultElement = document.getElementById('promise-result-element');
observable.subscribe(
    response => {
        
        resultElement.innerHTML = `${response}: Resolved`;
        resultElement.style.color = 'green';
    },
    error => {
        resultElement.innerHTML = `${error}: Rejected`;
        resultElement.style.color = 'red';
    }
);
                            </code>
                        </pre>
                    </div>
                    <div class="interaction">
                        <h3>Observable of random number promise!</h3>
                        <p>Click on the button and see if you got a nice number :) (> 0)</p>
                        <div class="w3-center">
                            <img src="./assets/showMeWhatYouGot.jpg" /> <br/> <br/>
                            <button class="w3-btn w3-brown w3-round-large" id="run-promise">Show me what you got!</button><p></p>
                            
                            <div class="w3-panel w3-card" id="promise-result" style="display: none">
                                <ul>
                                    <li class="result"><span class="result__title">You got!!</span> </li>
                                    <li class="result"><span class="result__title">You clicked: times</span> </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from API request
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
let btnViewGenres = document.querySelector('.view-genres');
const apiUrl = '...';
let requests$ = Rx.Observable
        .fromEvent(btnViewGenres, 'click')
        .map( _ => apiUrl);
let responses$ = requests$
        .flatMap(url => Rx.Observable.fromPromise(fetch(url)))
        .flatMap(r => Rx.Observable.fromPromise(r.json()));
let genres$ = responses$.map(getGenres);

genres$.subscribe(response => {
    response.forEach((genre) => {
        appendGenresToDOM(genre);
    });
});

function getGenres(res){
    return res.genres;
}

function toTemplate(genre){
    var a = document.createElement("a");
    a.textContent = genre.name;
    var div = document.createElement("div");
    div.appendChild(a);
    return div;
}

function appendGenresToDOM(genre){
    var t = toTemplate(genre);
    var g = document.getElementById('genres-box');
    g.appendChild(t);
}
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <button onClick="this.disabled=true;" class="w3-button w3-block w3-purple w3-round-large w3-hover-pink" style="width:100%" id="view-genres">View list of official genres for movies</button>
                        <div class="w3-panel w3-card" id="genres-box"></div>
                    </div>
                </div>
            </section>

            <section id="accordion"></section>
            
        </div>

        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>        
        <script src="dist/bundle.js"></script>
    </body>
</html>