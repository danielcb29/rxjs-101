<!doctype html>
<html lang="en" data-framework="javascript">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        <link rel="stylesheet" href="index.css">
        <title>RXJS 101</title>
    </head>
    <body>
        <div class="page">
            <h2 class="page__title">
                <img class="page__image" src="./assets/rxjs.png" />
                RxJS Code Examples
            </h2>
            <section id="helloworld"></section>

            <section class="example">
                <div class="example__title">
                    RxJS from input event
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
const observable = Rx.Observable.fromEvent(input, "input");
observable
    .map(event => event.target)
    .map(target => {
        // Take important information of the target
        const value = target.value;
        const letters = value.length;
        return {
            value: value,
            letters: letters,
        }
    })
    .do(data => {
        // Some validations :)
        data.value = data.value !== '' ? data.value : '-';
        data.letters = data.letters !== 0 ? data.letters : '-';
    })
    .subscribe(( { value, letters, timestamp } ) => {
        // Change the result elements
        const resultInput = document.getElementById('input-result');
        const lettersInput = document.getElementById('number-letters');

        resultInput.innerHTML = value;
        lettersInput.innerHTML = letters;
    });
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <h3>Observable of input event</h3>
                        <input class="w3-input w3-border" type="text" placeholder="Text" name="text" id="input-example">
                        <h4>Result</h4>
                        <ul>
                            <li class="result"><span class="result__title"><b>Input result:</b> <span id="input-result">-</span></span></li>
                            <li class="result"><span class="result__title"><b>Number of letters:</b> <span id="number-letters">-</span></span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from data structure event
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
const btnRegister = document.getElementById("register");
const boxNames = document.getElementById("collection-box");
const namesList = [];

const namesObservable = Rx.Observable.from(namesList).last();

const firstNameInput = document.getElementById("fn");
const lastNameInput = document.getElementById("ln");
                                
Rx.Observable.fromEvent(btnRegister, "click")
    .map(event => `${firstNameInput.value} ${lastNameInput.value}`)
    .do(fullName => {
        firstNameInput.value = '';
        lastNameInput.value = '';
    })
    .subscribe(fullName => {
        namesList.push(fullName);

        namesObservable.subscribe(lastNameAdded => {
            const li = document.createElement("li");
            li.innerHTML = lastNameAdded;
            boxNames.appendChild(li);
        })
    });
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <div class="w3-card-4" id="datastructure-example-form">
                            <p>      
                            <label class="w3-text-brown"><b>First Name</b></label>
                            <input class="w3-input w3-border w3-sand" style="width:90%; margin: 0 auto;" name="first" type="text" id='fn'></p>
                            <p>      
                            <label class="w3-text-brown"><b>Last Name</b></label>
                            <input class="w3-input w3-border w3-sand" style="width:90%; margin: 0 auto;" name="last" type="text" id='ln'></p>
                            <p>
                            <div class="w3-center">
                                <button class="w3-btn w3-brown w3-round-large" id="register">Register</button></p>
                            </div>
                            </p>
                        </div>
                        <div class="w3-container w3-block w3-purple w3-round-large w3-hover-pink w3-center" id="show"><p>Registerd Names</p></div>
                        <ul class="w3-container w3-card w3-round-large" id="collection-box"></ul>
                    </div>
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from mouse event
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
const mouseMove = Rx.Observable.fromEvent(document, "mousemove");
const text = "RxJs experiment";
const container = document.getElementById("mouseEvent-container");

for(let i=0; i < text.length; i++){
    (function(i){
        let s = document.createElement("span");
        s.innerHTML = text.charAt(i);
        s.style.position = "absolute";
        s.style.color = "#191970";
        container.appendChild(s);

        mouseMove.delay(i*100).subscribe(function(mouseEvent){
            s.style.top = mouseEvent.clientY + "px";
            s.style.left = mouseEvent.clientX + i * 10 + 15 + "px";
        });
    })(i);
}
                            </code>
                        </pre>                 
                    </div>
                    <div id="mouseEvent-container"></div>
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from Callback
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
let meal = null;
let juice = null;

function appendFoodToMenu(type, food) {
    const span = document.getElementById(`${type}-option`);
    span.innerHTML = food;
}

function selectMeal(appendFunction){
    appendFunction('meal', meal);
}

function selectJuice(appendFunction){
    appendFunction('juice', juice);
}

const boundSelectMeal = Rx.Observable.bindCallback(selectMeal);
const boundSelectJuice = Rx.Observable.bindCallback(selectJuice);

... // Selector logic
.subscribe(newMeal => {
    meal = newMeal;
    selectMeal(appendFoodToMenu);
    const mealObservable = boundSelectMeal();
    mealObservable
        .subscribe(data => {
            console.log('Callback binded to Obsevable', data);
        });
});
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <h3>Observable binded by Callback</h3>
                        <p>Select your lunch following next options</p>
                        <div id="lunch-order">
                            <h4>Your lunch order</h4>
                            <ul id="lunch-list">
                                <li class="result">Meal: <span id="meal-option">You didn't select a meal</span></li>
                                <li class="result">Juice: <span id="juice-option">You didn't select a juice</span></li>
                            </ul>
                        </div>
                        <div>
                            <h4>Your lunch options</h4>
                            <p>Step 1: Select your meal</p>
                            <select class="w3-select w3-border" name="option" id="meal-selector">
                                <option value="" disabled selected>Choose your meal option</option>
                                <option value="Pork">Pork</option>
                                <option value="Beef">Beef</option>
                                <option value="Chicken">Chicken</option>
                            </select>
                            <p>Step 2: Select your juice</p>
                            <select class="w3-select w3-border" name="option" id="juice-selector">
                                <option value="" disabled selected>Choose your juice option</option>
                                <option value="Orange">Orange</option>
                                <option value="Lulo">Lulo</option>
                                <option value="Maracuyá">Maracuyá</option>
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from basic Promise
                </div>
                <div class="example__content">
                    <div class="code">
                        <pre class="prettyprint lang-js">
                            <code>
const promise = new Promise((resolve, reject) => {
    const random = parseInt(Math.random() * 10);
    if (random === 0) {
        reject(random);
    }
    resolve(random);
});

const observable = Rx.Observable.fromPromise(promise);
const resultElement = document.getElementById('promise-result-element');
observable.subscribe(
    response => {
        
        resultElement.innerHTML = `${response}: Resolved`;
        resultElement.style.color = 'green';
    },
    error => {
        resultElement.innerHTML = `${error}: Rejected`;
        resultElement.style.color = 'red';
    }
);
                            </code>
                        </pre>
                    </div>
                    <div class="interaction">
                        <h3>Observable of random number promise!</h3>
                        <p>Click on the button and see if you got a nice number :) (> 0)</p>
                        <div class="w3-center">
                            <img src="./assets/showMeWhatYouGot.jpg" /> <br/> <br/>
                            <button class="w3-btn w3-brown w3-round-large" id="run-promise">Show me what you got!</button><p></p>
                            
                            <div class="w3-panel w3-card" id="promise-result" style="display: none">
                                <ul>
                                    <li class="result"><span class="result__title">You got!!</span> </li>
                                    <li class="result"><span class="result__title">You clicked: times</span> </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from API request
                </div>
                <div class="example__content">
                    <div class="code">                    
                        <pre class="prettyprint lang-js">
                            <code >
                            
let btnViewGenres = document.querySelector('.view-genres');
const apiUrl = '...';
let requests$ = Rx.Observable
        .fromEvent(btnViewGenres, 'click')
        .map( _ => apiUrl);
let responses$ = requests$
        .flatMap(url => Rx.Observable.fromPromise(fetch(url)))
        .flatMap(r => Rx.Observable.fromPromise(r.json()));
let genres$ = responses$.map(getGenres);

genres$.subscribe(response => {
    response.forEach((genre) => {
        appendGenresToDOM(genre);
    });
});

function getGenres(res){
    return res.genres;
}

function toTemplate(genre){
    var a = document.createElement("a");
    a.textContent = genre.name;
    var div = document.createElement("div");
    div.appendChild(a);
    return div;
}

function appendGenresToDOM(genre){
    var t = toTemplate(genre);
    var g = document.getElementById('genres-box');
    g.appendChild(t);
}
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <button onClick="this.disabled=true;" class="w3-button w3-block w3-purple w3-round-large w3-hover-pink" style="width:100%" id="view-genres">View list of official genres for movies</button>
                        <div class="w3-panel w3-card" id="genres-box"></div>
                    </div>
                </div>
            </section>

            <section class="example">
                <div class="example__title">
                    RxJS from ... any implementation
                </div>
                <div class="example__content">
                    <div class="code">
                        <pre class="prettyprint lang-js">
                            <code >
const observable = Rx.Observable.fromEvent(accordionHeader, "click");
observable
    .map(event => event.target)
    .map(target => {
        const isActive = target.classList.contains("active");
        const display = active ? "none" : "flex";
        return {
            isActive: isActive,
            target: target,
            display: display
        };
    })
    .do(({ target, isActive }) => {
        if (isActive) {
            target.classList.remove("active");
        } else {
            target.classList.toggle("active");
        }
    })
    .do(
        targetOptions => {
            targetOptions.target = targetOptions.target.nextElementSibling
    })
    .subscribe(({ target, display }) => {
        target.style.display = display;
    });
                            </code>
                        </pre>                 
                    </div>
                    <div class="interaction">
                        <h3>This Accordion was implemented using RxJS!! :D</h3>
                        <p>This accordion uses RxJS to handle click envents and show or dismiss content blocks</p>
                        <ol>
                            <li class="result"><span class="result__title">Catch event</span></li>
                            <li class="result"><span class="result__title">Define if is currently active or not</span></li>
                            <li class="result"><span class="result__title">Change element class</span></li>
                            <li class="result"><span class="result__title">Get next element (content)</span></li>
                            <li class="result"><span class="result__title">Change display property of the event</span></li>
                        </ol>
                    </div>
                </div>
            </section>
            
        </div>

        <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>        
        <script src="dist/bundle.js"></script>
    </body>
</html>